<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started | Kinetix</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --form-bg: #FFFFFF;
            --form-border: #DEE2E6;
            --input-bg: #F8F9FA;
            --primary: #1B5E20;
            --accent: #2E7D32;
            --text: #212529;
            --border: #DEE2E6;
        }

        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #F4F7F9;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            font-family: 'Inter', sans-serif;
            padding: 60px 20px;
        }

        .auth-bg {
            display: none;
            /* Hide neon balls */
        }

        .auth-card {
            width: 100%;
            max-width: 650px;
            padding: 50px;
            background: var(--form-bg);
            border: 1px solid var(--form-border);
            border-radius: 12px;
            z-index: 10;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 51, 102, 0.1);
        }

        .brand-logo {
            font-weight: 800;
            font-size: 1.6rem;
            letter-spacing: 2px;
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
        }

        /* Progress Indicator */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            background: var(--border);
            z-index: 1;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 50%;
            z-index: 2;
            transition: all 0.4s;
            position: relative;
        }

        .progress-dot.active {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent);
        }

        .progress-dot.completed {
            background: var(--accent);
            border-color: var(--accent);
        }

        .step-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 800;
        }

        .step-sub {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 35px;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        /* Form Fields */
        .field {
            position: relative;
            margin-bottom: 24px;
        }

        .field label {
            position: absolute;
            left: 20px;
            top: 18px;
            color: var(--text-muted);
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .field input,
        .field select,
        .field textarea {
            width: 100%;
            padding: 26px 20px 10px;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            /* More corporate rectangular corners */
            color: var(--text);
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .field input:focus,
        .field select:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(0, 255, 163, 0.03);
        }

        .field input:focus+label,
        .field input:not(:placeholder-shown)+label,
        .field select:focus+label,
        .field select:not([value=""])+label {
            top: 8px;
            left: 20px;
            font-size: 0.7rem;
            color: var(--accent);
            font-weight: 600;
            letter-spacing: 1px;
        }

        .field select option {
            background-color: #111;
            color: #fff;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Questionnaire Styles */
        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--surface);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .question-label {
            display: block;
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .radio-options {
            display: flex;
            gap: 20px;
        }

        .radio-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--text);
            font-size: 0.9rem;
        }

        .radio-btn input {
            width: auto;
            padding: 0;
            accent-color: var(--accent);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }

        .btn-auth {
            flex: 1;
            padding: 18px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s;
            border: none;
            letter-spacing: 1px;
        }

        .btn-next {
            background: var(--accent);
            color: #000;
        }

        .btn-reset {
            background: #FFFFFF;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-reset:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 255, 163, 0.2);
        }

        .back-link a:hover {
            color: var(--primary);
        }

        /* File Upload Styling */
        .file-upload-group {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .file-upload-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .file-field {
            margin-bottom: 15px;
        }

        .file-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--input-bg);
            border: 1px dashed var(--border);
            padding: 12px 15px;
            border-radius: 4px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-input-wrapper:hover {
            border-color: var(--primary);
            background: rgba(27, 94, 32, 0.02);
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .file-label-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-icon {
            font-size: 1.2rem;
            color: var(--primary);
        }
    </style>
</head>

<body class="auth-page">
    <div class="auth-card" id="signup-card">
        <div class="brand-logo">KINETIX</div>

        <div class="progress-bar">
            <div class="progress-dot active" data-step="1"></div>
            <div class="progress-dot" data-step="2"></div>
        </div>

        <form id="signup-form">
            <!-- STEP 1: CONTACT & COMPANY -->
            <div class="form-step active" id="step-1">
                <h2 class="step-title">Initial Phase</h2>
                <p class="step-sub">Introduce your entity to the Kinetix ecosystem.</p>

                <div class="input-row">
                    <div class="field">
                        <input type="text" id="fname" placeholder=" " required>
                        <label for="fname">First Name</label>
                    </div>
                    <div class="field">
                        <input type="text" id="lname" placeholder=" " required>
                        <label for="lname">Last Name</label>
                    </div>
                </div>

                <div class="field">
                    <input type="text" id="company" placeholder=" " required>
                    <label for="company">Company Name</label>
                </div>

                <div class="field">
                    <textarea id="address" placeholder=" " required rows="2"
                        style="padding-top: 30px; min-height: 80px;"></textarea>
                    <label for="address">Company Registered Address</label>
                </div>

                <div class="input-row">
                    <div class="field">
                        <select id="country" required onchange="updateStates()">
                            <option value="" disabled selected hidden></option>
                            <option value="US">United States</option>
                            <option value="UK">United Kingdom</option>
                            <option value="IN">India</option>
                            <option value="SG">Singapore</option>
                            <option value="AE">United Arab Emirates</option>
                            <option value="Other">Other</option>
                        </select>
                        <label for="country">Country</label>
                    </div>
                    <div class="field">
                        <input type="text" id="state" list="state-list" required disabled placeholder=" ">
                        <label for="state">State / Province</label>
                        <datalist id="state-list"></datalist>
                    </div>
                </div>

                <div class="field">
                    <input type="email" id="email" placeholder=" " required>
                    <label for="email">Professional Email Address</label>
                </div>

                <div class="input-row">
                    <div class="field">
                        <input type="text" id="city" list="city-list" placeholder=" " required>
                        <label for="city">City</label>
                        <datalist id="city-list"></datalist>
                    </div>
                    <div class="field">
                        <input type="text" id="zip" placeholder=" " required>
                        <label for="zip">Zip / Postal Code</label>
                    </div>
                </div>

                <div class="field">
                    <input type="tel" id="phone" placeholder=" " required pattern="^\+[1-9]\d{1,14}$"
                        title="Please enter a valid international phone number starting with + (e.g. +123456789)">
                    <label for="phone">Phone Number (with Country Code)</label>
                </div>

                <div class="field">
                    <input type="text" id="lei" placeholder=" " required>
                    <label for="lei">Legal Entity Identifier (LEI)</label>
                </div>

                <div class="field">
                    <select id="entity-type" required>
                        <option value="" disabled selected hidden></option>
                        <option value="bank">Bank</option>
                        <option value="broker-dealer">Broker-Dealer</option>
                        <option value="fund">Fund</option>
                        <option value="corporate">Corporate</option>
                        <option value="other">Other</option>
                    </select>
                    <label for="entity-type">Entity Type</label>
                </div>

                <div class="file-upload-group">
                    <span class="file-upload-title">Compliance Documentation</span>

                    <div class="file-field">
                        <div class="file-input-wrapper">
                            <span class="file-icon">üìÑ</span>
                            <span class="file-label-text" id="label-bod">Board of Directors List</span>
                            <input type="file" id="file-bod" accept=".pdf,.doc,.docx" required
                                onchange="updateFileLabel(this, 'label-bod')">
                        </div>
                    </div>

                    <div class="file-field">
                        <div class="file-input-wrapper">
                            <span class="file-icon">üìä</span>
                            <span class="file-label-text" id="label-financials">Financials (Audited Balance
                                Sheet)</span>
                            <input type="file" id="file-financials" accept=".pdf,.jpg,.png" required
                                onchange="updateFileLabel(this, 'label-financials')">
                        </div>
                    </div>

                    <div class="file-field">
                        <div class="file-input-wrapper">
                            <span class="file-icon">üè¢</span>
                            <span class="file-label-text" id="label-ownership">Ownership Structure</span>
                            <input type="file" id="file-ownership" accept=".pdf,.jpg,.png" required
                                onchange="updateFileLabel(this, 'label-ownership')">
                        </div>
                    </div>
                </div>

                <div class="field" style="margin-top: 24px;">
                    <select id="product" required>
                        <option value="" disabled selected hidden></option>
                        <option value="payments">Global Payments</option>
                        <option value="fx">FX Solutions</option>
                        <option value="compliance">Compliance API</option>
                    </select>
                    <label for="product">Product Interest</label>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-auth btn-reset" onclick="resetForm()">RESET</button>
                    <button type="button" class="btn-auth btn-next" onclick="goToStep(2)">NEXT STEP</button>
                </div>
            </div>

            <!-- STEP 2: AML QUESTIONNAIRE -->
            <div class="form-step" id="step-2">
                <h2 class="step-title">AML Assessment</h2>
                <p class="step-sub">Standard due diligence for institutional access.</p>

                <div class="field">
                    <input type="text" id="reg-num" placeholder=" " required>
                    <label for="reg-num">Registration Number</label>
                </div>

                <div class="field">
                    <select id="ownership-type" required>
                        <option value="" disabled selected hidden></option>
                        <option>Publicly Traded</option>
                        <option>Privately Held</option>
                        <option>Government Owned</option>
                        <option>Subsidiary</option>
                    </select>
                    <label for="ownership-type">Ownership Type</label>
                </div>

                <div class="field">
                    <select id="business-activity" required>
                        <option value="" disabled selected hidden></option>
                        <option>Investment Banking</option>
                        <option>Asset Management</option>
                        <option>Retail Banking</option>
                        <option>Fintech / Payments</option>
                        <option>Energy / Commodities</option>
                        <option>Real Estate</option>
                        <option>Other</option>
                    </select>
                    <label for="business-activity">Primary Business Activity</label>
                </div>

                <div class="field">
                    <select id="source-of-funds" required>
                        <option value="" disabled selected hidden></option>
                        <option>Operating Revenues</option>
                        <option>Shareholder Capital</option>
                        <option>Investment Returns</option>
                        <option>Loan / Credit Facility</option>
                        <option>Other</option>
                    </select>
                    <label for="source-of-funds">Source of Funds</label>
                </div>

                <div class="field">
                    <select id="expected-volume" required>
                        <option value="" disabled selected hidden></option>
                        <option>
                            < $1M</option>
                        <option>$1M - $10M</option>
                        <option>$10M - $100M</option>
                        <option>$100M+</option>
                    </select>
                    <label for="expected-volume">Expected Monthly Volume (USD)</label>
                </div>

                <div class="field">
                    <input type="text" id="countries-op" placeholder=" " required>
                    <label for="countries-op">Main Countries of Operation</label>
                </div>

                <div class="question-group">
                    <span class="question-label">Any Sanctions or PEP exposure? *</span>
                    <div class="radio-options">
                        <label class="radio-btn"><input type="radio" name="sanctions" value="no" required checked>
                            No</label>
                        <label class="radio-btn"><input type="radio" name="sanctions" value="yes" required> Yes</label>
                    </div>
                </div>

                <div class="question-group">
                    <span class="question-label">Confirm established AML Program? *</span>
                    <div class="radio-options">
                        <label class="radio-btn"><input type="radio" name="aml" value="yes" required checked>
                            Yes</label>
                        <label class="radio-btn"><input type="radio" name="aml" value="no" required> No</label>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-auth btn-reset" onclick="goToStep(1)">BACK</button>
                    <button type="submit" class="btn-auth btn-next">SUBMIT REQUEST</button>
                </div>
            </div>
        </form>

        <div class="back-link">
            <a href="index.html">‚Üê Return to Main Application</a>
        </div>
    </div>

    <script>
        function updateFileLabel(input, labelId) {
            const label = document.getElementById(labelId);
            if (input.files && input.files[0]) {
                label.innerText = input.files[0].name;
                label.style.color = 'var(--primary)';
                label.style.fontWeight = '600';
            } else {
                label.innerText = label.getAttribute('data-original') || 'Select File';
                label.style.color = 'var(--text-muted)';
            }
        }

        // Initialize original labels
        document.querySelectorAll('.file-label-text').forEach(label => {
            label.setAttribute('data-original', label.innerText);
        });

        // Form Logic
        function goToStep(step) {
            const s1 = document.getElementById('step-1');
            const s2 = document.getElementById('step-2');
            const dots = document.querySelectorAll('.progress-dot');

            if (step === 2) {
                // Validate Step 1 - Strictly Top-Down
                const step1El = document.getElementById('step-1');
                const inputs = step1El.querySelectorAll('input, select, textarea');
                let firstInvalid = null;

                for (const input of inputs) {
                    if (!input.checkValidity()) {
                        firstInvalid = input;
                        break;
                    }
                }

                if (firstInvalid) {
                    firstInvalid.reportValidity();
                    return;
                }

                gsap.to(s1, {
                    opacity: 0, x: -20, duration: 0.4, onComplete: () => {
                        s1.classList.remove('active');
                        s2.classList.add('active');
                        gsap.fromTo(s2, { opacity: 0, x: 20 }, { opacity: 1, x: 0, duration: 0.4 });
                        dots[1].classList.add('active');
                    }
                });
            } else {
                gsap.to(s2, {
                    opacity: 0, x: 20, duration: 0.4, onComplete: () => {
                        s2.classList.remove('active');
                        s1.classList.add('active');
                        gsap.fromTo(s1, { opacity: 0, x: -20 }, { opacity: 1, x: 0, duration: 0.4 });
                        dots[1].classList.remove('active');
                    }
                });
            }
        }

        function resetForm() {
            document.getElementById('signup-form').reset();
        }

        // Address Logic
        const statesData = {
            "US": [
                "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia",
                "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
                "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey",
                "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina",
                "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"
            ],
            "IN": [
                "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand",
                "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab",
                "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"
            ],
            "UK": ["England", "Scotland", "Wales", "Northern Ireland"],
            "SG": ["Central", "North", "South"],
            "AE": ["Dubai", "Abu Dhabi", "Sharjah"],
            "Other": []
        };

        const citySuggestions = {
            "US": ["New York City", "Los Angeles", "Chicago", "Houston", "Phoenix", "Philadelphia", "San Antonio", "San Diego", "Dallas", "San Jose"],
            "IN": ["Mumbai", "Delhi", "Bangalore", "Hyderabad", "Ahmedabad", "Chennai", "Kolkata", "Surat", "Pune", "Jaipur"],
            "UK": ["London", "Birmingham", "Manchester", "Glasgow", "Liverpool", "Leeds", "Sheffield", "Edinburgh", "Bristol", "Leicester"]
        };

        function updateStates() {
            const country = document.getElementById('country').value;
            const stateInput = document.getElementById('state');
            const stateList = document.getElementById('state-list');
            const cityList = document.getElementById('city-list');

            stateList.innerHTML = '';
            cityList.innerHTML = '';
            stateInput.value = '';

            if (statesData[country]) {
                statesData[country].forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    stateList.appendChild(opt);
                });
                stateInput.disabled = false;
            } else {
                stateInput.disabled = true;
            }

            if (citySuggestions[country]) {
                citySuggestions[country].forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    cityList.appendChild(opt);
                });
            }
        }

        document.getElementById('signup-form').onsubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalBtnText = btn.innerText;

            btn.innerText = "PROCESSING...";
            btn.disabled = true;

            const formData = new FormData();

            // Map form IDs to backend fields
            const fields = {
                'fname': 'fname', 'lname': 'lname', 'email': 'email', 'company': 'company',
                'address': 'address', 'country': 'country', 'state': 'state', 'city': 'city',
                'zip': 'zip', 'phone': 'phone', 'lei': 'lei', 'entity-type': 'entity_type',
                'product': 'product', 'reg-num': 'reg_num', 'ownership-type': 'ownership_type',
                'business-activity': 'business_activity', 'source-of-funds': 'source_of_funds',
                'expected-volume': 'expected_volume', 'countries-op': 'countries_op'
            };

            for (const [id, name] of Object.entries(fields)) {
                formData.append(name, document.getElementById(id).value);
            }

            // Radio buttons
            formData.append('sanctions', form.querySelector('input[name="sanctions"]:checked').value);
            formData.append('aml', form.querySelector('input[name="aml"]:checked').value);

            // Files
            formData.append('file_bod', document.getElementById('file-bod').files[0]);
            formData.append('file_financials', document.getElementById('file-financials').files[0]);
            formData.append('file_ownership', document.getElementById('file-ownership').files[0]);

            try {
                const response = await fetch('http://localhost:8000/signup', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    showThankYou(result.tracking_id);
                } else {
                    const error = await response.json();
                    alert("Submission failed: " + (error.detail || "Unknown error"));
                    btn.innerText = originalBtnText;
                    btn.disabled = false;
                }
            } catch (err) {
                console.error("Error:", err);
                alert("Communication error with server. Please ensure the backend is running.");
                btn.innerText = originalBtnText;
                btn.disabled = false;
            }
        };

        function showThankYou(trackingId) {
            const card = document.getElementById('signup-card');
            gsap.to(card, {
                opacity: 0, scale: 0.95, duration: 0.5, onComplete: () => {
                    card.innerHTML = `
                        <div style="text-align: center; padding: 40px 0;">
                            <div class="brand-logo" style="margin-bottom: 40px;">KINETIX</div>
                            <div style="font-size: 4rem; margin-bottom: 20px;">‚úÖ</div>
                            <h2 class="step-title" style="font-size: 2.2rem; margin-bottom: 20px;">Thank You</h2>
                            <p style="font-size: 1.1rem; color: var(--text); margin-bottom: 10px; line-height: 1.6;">
                                Your institutional application has been successfully submitted.
                            </p>
                            <div style="margin-bottom: 30px;">
                                <span style="font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">Tracking ID:</span>
                                <div style="font-size: 1.4rem; font-weight: 800; color: var(--primary); font-family: monospace; background: #f0f7f0; display: inline-block; padding: 8px 15px; border-radius: 4px; border: 1px dashed var(--primary); margin-top: 5px;">${trackingId}</div>
                            </div>
                            <div style="background: rgba(27, 94, 32, 0.05); border: 1px solid var(--primary); padding: 25px; border-radius: 12px; margin-bottom: 40px;">
                                <p style="color: var(--primary); font-weight: 700; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">
                                    Status: Verification In Progress
                                </p>
                                <p style="font-size: 0.9rem; color: var(--text-muted);">
                                    Our Internal Operations team is currently vetting your entity details and compliance documentation. A confirmation email has been sent to your registered professional address.
                                </p>
                            </div>
                            <a href="index.html" class="btn-auth btn-next" style="display: inline-block; text-decoration: none; width: auto; padding: 18px 40px;">Return to Hub</a>
                        </div>
                    `;
                    gsap.fromTo(card, { opacity: 0, scale: 1.05 }, { opacity: 1, scale: 1, duration: 0.8, ease: "back.out(1.7)" });
                }
            });
        }

        // Entrance animation
        gsap.from('#signup-card', { opacity: 0, y: 50, duration: 1, ease: "expo.out" });
    </script>
</body>

</html>